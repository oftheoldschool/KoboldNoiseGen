constant static int const N_GRADS_4D_EXPONENT = 9;
constant static int const N_GRADS_4D = 512;
constant static float GRADIENTS_4D[N_GRADS_4D * 8] = { -30.62745475769, -14.722168922424, -14.722168922424, 26.33158493042, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -40.115985870361, 3.71012878418, 3.71012878418, 20.689500808716, -20.689500808716, -3.71012878418, -3.71012878418, 40.115985870361, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -26.33158493042, 14.722168922424, 14.722168922424, 30.62745475769, -30.62745475769, -14.722168922424, 26.33158493042, -14.722168922424, -34.102886199951, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -40.115985870361, 3.71012878418, 20.689500808716, 3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -3.71012878418, -22.856151580811, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -26.33158493042, 14.722168922424, 30.62745475769, 14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -14.722168922424, -34.102886199951, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -40.115985870361, 20.689500808716, 3.71012878418, 3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -3.71012878418, -22.856151580811, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -26.33158493042, 30.62745475769, 14.722168922424, 14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -14.722168922424, 22.856151580811, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 20.689500808716, -40.115985870361, 3.71012878418, 3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -3.71012878418, 34.102886199951, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 30.62745475769, -26.33158493042, 14.722168922424, 14.722168922424, -34.232513427734, -17.253143310547, -17.253143310547, -17.253143310547, -35.542457580566, -19.637172698975, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, -19.637172698975, -39.017890930176, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -45.362899780273, -1.53678560257, -1.53678560257, -1.53678560257, -17.253143310547, -34.232513427734, -17.253143310547, -17.253143310547, -19.637172698975, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, -19.637172698975, -23.112604141235, -39.017890930176, 2.035861253738, 2.035861253738, 2.035861253738, -39.017890930176, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, -1.53678560257, -45.362899780273, -1.53678560257, -1.53678560257, -17.253143310547, -17.253143310547, -34.232513427734, -17.253143310547, -19.637172698975, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, -19.637172698975, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -39.017890930176, 2.035861253738, 2.035861253738, 2.035861253738, -39.017890930176, -23.112604141235, -1.53678560257, -1.53678560257, -45.362899780273, -1.53678560257, -17.253143310547, -17.253143310547, -17.253143310547, -34.232513427734, -19.637172698975, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, -19.637172698975, -35.542457580566, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -39.017890930176, -1.53678560257, -1.53678560257, -1.53678560257, -45.362899780273, -14.722168922424, -30.62745475769, -14.722168922424, 26.33158493042, -18.197601318359, -34.102886199951, 6.950865268707, 22.856151580811, 6.950865268707, -34.102886199951, -18.197601318359, 22.856151580811, 3.71012878418, -40.115985870361, 3.71012878418, 20.689500808716, -3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -6.950865268707, -22.856151580811, 18.197601318359, 34.102886199951, 18.197601318359, -22.856151580811, -6.950865268707, 34.102886199951, 14.722168922424, -26.33158493042, 14.722168922424, 30.62745475769, -14.722168922424, -14.722168922424, -30.62745475769, 26.33158493042, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -34.102886199951, 22.856151580811, 3.71012878418, 3.71012878418, -40.115985870361, 20.689500808716, -3.71012878418, -3.71012878418, -20.689500808716, 40.115985870361, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -22.856151580811, 34.102886199951, 14.722168922424, 14.722168922424, -26.33158493042, 30.62745475769, -14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -18.197601318359, -34.102886199951, 22.856151580811, 6.950865268707, 6.950865268707, -34.102886199951, 22.856151580811, -18.197601318359, 3.71012878418, -40.115985870361, 20.689500808716, 3.71012878418, -3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -6.950865268707, -22.856151580811, 34.102886199951, 18.197601318359, 18.197601318359, -22.856151580811, 34.102886199951, -6.950865268707, 14.722168922424, -26.33158493042, 30.62745475769, 14.722168922424, -14.722168922424, -14.722168922424, 26.33158493042, -30.62745475769, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -34.102886199951, 3.71012878418, 3.71012878418, 20.689500808716, -40.115985870361, -3.71012878418, -3.71012878418, 40.115985870361, -20.689500808716, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -22.856151580811, 14.722168922424, 14.722168922424, 30.62745475769, -26.33158493042, -14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -18.197601318359, 22.856151580811, -34.102886199951, 6.950865268707, 6.950865268707, 22.856151580811, -34.102886199951, -18.197601318359, 3.71012878418, 20.689500808716, -40.115985870361, 3.71012878418, -3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -6.950865268707, 34.102886199951, -22.856151580811, 18.197601318359, 18.197601318359, 34.102886199951, -22.856151580811, -6.950865268707, 14.722168922424, 30.62745475769, -26.33158493042, 14.722168922424, -14.722168922424, 26.33158493042, -14.722168922424, -30.62745475769, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -34.102886199951, 3.71012878418, 20.689500808716, 3.71012878418, -40.115985870361, -3.71012878418, 40.115985870361, -3.71012878418, -20.689500808716, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -22.856151580811, 14.722168922424, 30.62745475769, 14.722168922424, -26.33158493042, 26.33158493042, -14.722168922424, -30.62745475769, -14.722168922424, 22.856151580811, -18.197601318359, -34.102886199951, 6.950865268707, 22.856151580811, 6.950865268707, -34.102886199951, -18.197601318359, 20.689500808716, 3.71012878418, -40.115985870361, 3.71012878418, 40.115985870361, -3.71012878418, -20.689500808716, -3.71012878418, 34.102886199951, -6.950865268707, -22.856151580811, 18.197601318359, 34.102886199951, 18.197601318359, -22.856151580811, -6.950865268707, 30.62745475769, 14.722168922424, -26.33158493042, 14.722168922424, 26.33158493042, -14.722168922424, -14.722168922424, -30.62745475769, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -34.102886199951, 20.689500808716, 3.71012878418, 3.71012878418, -40.115985870361, 40.115985870361, -3.71012878418, -3.71012878418, -20.689500808716, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -22.856151580811, 30.62745475769, 14.722168922424, 14.722168922424, -26.33158493042, 1.53678560257, 1.53678560257, 1.53678560257, 45.362899780273, -2.035861253738, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 39.017890930176, -5.511293888092, 19.637172698975, 19.637172698975, 35.542457580566, 23.112604141235, -2.035861253738, -2.035861253738, 39.017890930176, 19.637172698975, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 19.637172698975, -5.511293888092, 35.542457580566, 17.253143310547, 17.253143310547, 17.253143310547, 34.232513427734, 1.53678560257, 1.53678560257, 45.362899780273, 1.53678560257, -2.035861253738, 2.035861253738, 39.017890930176, 23.112604141235, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 23.112604141235, -2.035861253738, 39.017890930176, -2.035861253738, 19.637172698975, -5.511293888092, 35.542457580566, 19.637172698975, 19.637172698975, 19.637172698975, 35.542457580566, -5.511293888092, 17.253143310547, 17.253143310547, 34.232513427734, 17.253143310547, 1.53678560257, 45.362899780273, 1.53678560257, 1.53678560257, -2.035861253738, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 39.017890930176, 23.112604141235, -2.035861253738, -5.511293888092, 35.542457580566, 19.637172698975, 19.637172698975, 23.112604141235, 39.017890930176, -2.035861253738, -2.035861253738, 19.637172698975, 35.542457580566, -5.511293888092, 19.637172698975, 19.637172698975, 35.542457580566, 19.637172698975, -5.511293888092, 17.253143310547, 34.232513427734, 17.253143310547, 17.253143310547, 45.362899780273, 1.53678560257, 1.53678560257, 1.53678560257, 39.017890930176, -2.035861253738, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 35.542457580566, -5.511293888092, 19.637172698975, 19.637172698975, 39.017890930176, 23.112604141235, -2.035861253738, -2.035861253738, 35.542457580566, 19.637172698975, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 19.637172698975, -5.511293888092, 34.232513427734, 17.253143310547, 17.253143310547, 17.253143310547, -30.62745475769, -14.722168922424, -14.722168922424, 26.33158493042, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -40.115985870361, 3.71012878418, 3.71012878418, 20.689500808716, -20.689500808716, -3.71012878418, -3.71012878418, 40.115985870361, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -26.33158493042, 14.722168922424, 14.722168922424, 30.62745475769, -30.62745475769, -14.722168922424, 26.33158493042, -14.722168922424, -34.102886199951, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -40.115985870361, 3.71012878418, 20.689500808716, 3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -3.71012878418, -22.856151580811, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -26.33158493042, 14.722168922424, 30.62745475769, 14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -14.722168922424, -34.102886199951, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -40.115985870361, 20.689500808716, 3.71012878418, 3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -3.71012878418, -22.856151580811, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -26.33158493042, 30.62745475769, 14.722168922424, 14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -14.722168922424, 22.856151580811, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 20.689500808716, -40.115985870361, 3.71012878418, 3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -3.71012878418, 34.102886199951, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 30.62745475769, -26.33158493042, 14.722168922424, 14.722168922424, -34.232513427734, -17.253143310547, -17.253143310547, -17.253143310547, -35.542457580566, -19.637172698975, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, -19.637172698975, -39.017890930176, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -45.362899780273, -1.53678560257, -1.53678560257, -1.53678560257, -17.253143310547, -34.232513427734, -17.253143310547, -17.253143310547, -19.637172698975, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, -19.637172698975, -23.112604141235, -39.017890930176, 2.035861253738, 2.035861253738, 2.035861253738, -39.017890930176, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, -1.53678560257, -45.362899780273, -1.53678560257, -1.53678560257, -17.253143310547, -17.253143310547, -34.232513427734, -17.253143310547, -19.637172698975, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, -19.637172698975, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -39.017890930176, 2.035861253738, 2.035861253738, 2.035861253738, -39.017890930176, -23.112604141235, -1.53678560257, -1.53678560257, -45.362899780273, -1.53678560257, -17.253143310547, -17.253143310547, -17.253143310547, -34.232513427734, -19.637172698975, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, -19.637172698975, -35.542457580566, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -39.017890930176, -1.53678560257, -1.53678560257, -1.53678560257, -45.362899780273, -14.722168922424, -30.62745475769, -14.722168922424, 26.33158493042, -18.197601318359, -34.102886199951, 6.950865268707, 22.856151580811, 6.950865268707, -34.102886199951, -18.197601318359, 22.856151580811, 3.71012878418, -40.115985870361, 3.71012878418, 20.689500808716, -3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -6.950865268707, -22.856151580811, 18.197601318359, 34.102886199951, 18.197601318359, -22.856151580811, -6.950865268707, 34.102886199951, 14.722168922424, -26.33158493042, 14.722168922424, 30.62745475769, -14.722168922424, -14.722168922424, -30.62745475769, 26.33158493042, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -34.102886199951, 22.856151580811, 3.71012878418, 3.71012878418, -40.115985870361, 20.689500808716, -3.71012878418, -3.71012878418, -20.689500808716, 40.115985870361, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -22.856151580811, 34.102886199951, 14.722168922424, 14.722168922424, -26.33158493042, 30.62745475769, -14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -18.197601318359, -34.102886199951, 22.856151580811, 6.950865268707, 6.950865268707, -34.102886199951, 22.856151580811, -18.197601318359, 3.71012878418, -40.115985870361, 20.689500808716, 3.71012878418, -3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -6.950865268707, -22.856151580811, 34.102886199951, 18.197601318359, 18.197601318359, -22.856151580811, 34.102886199951, -6.950865268707, 14.722168922424, -26.33158493042, 30.62745475769, 14.722168922424, -14.722168922424, -14.722168922424, 26.33158493042, -30.62745475769, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -34.102886199951, 3.71012878418, 3.71012878418, 20.689500808716, -40.115985870361, -3.71012878418, -3.71012878418, 40.115985870361, -20.689500808716, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -22.856151580811, 14.722168922424, 14.722168922424, 30.62745475769, -26.33158493042, -14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -18.197601318359, 22.856151580811, -34.102886199951, 6.950865268707, 6.950865268707, 22.856151580811, -34.102886199951, -18.197601318359, 3.71012878418, 20.689500808716, -40.115985870361, 3.71012878418, -3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -6.950865268707, 34.102886199951, -22.856151580811, 18.197601318359, 18.197601318359, 34.102886199951, -22.856151580811, -6.950865268707, 14.722168922424, 30.62745475769, -26.33158493042, 14.722168922424, -14.722168922424, 26.33158493042, -14.722168922424, -30.62745475769, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -34.102886199951, 3.71012878418, 20.689500808716, 3.71012878418, -40.115985870361, -3.71012878418, 40.115985870361, -3.71012878418, -20.689500808716, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -22.856151580811, 14.722168922424, 30.62745475769, 14.722168922424, -26.33158493042, 26.33158493042, -14.722168922424, -30.62745475769, -14.722168922424, 22.856151580811, -18.197601318359, -34.102886199951, 6.950865268707, 22.856151580811, 6.950865268707, -34.102886199951, -18.197601318359, 20.689500808716, 3.71012878418, -40.115985870361, 3.71012878418, 40.115985870361, -3.71012878418, -20.689500808716, -3.71012878418, 34.102886199951, -6.950865268707, -22.856151580811, 18.197601318359, 34.102886199951, 18.197601318359, -22.856151580811, -6.950865268707, 30.62745475769, 14.722168922424, -26.33158493042, 14.722168922424, 26.33158493042, -14.722168922424, -14.722168922424, -30.62745475769, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -34.102886199951, 20.689500808716, 3.71012878418, 3.71012878418, -40.115985870361, 40.115985870361, -3.71012878418, -3.71012878418, -20.689500808716, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -22.856151580811, 30.62745475769, 14.722168922424, 14.722168922424, -26.33158493042, 1.53678560257, 1.53678560257, 1.53678560257, 45.362899780273, -2.035861253738, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 39.017890930176, -5.511293888092, 19.637172698975, 19.637172698975, 35.542457580566, 23.112604141235, -2.035861253738, -2.035861253738, 39.017890930176, 19.637172698975, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 19.637172698975, -5.511293888092, 35.542457580566, 17.253143310547, 17.253143310547, 17.253143310547, 34.232513427734, 1.53678560257, 1.53678560257, 45.362899780273, 1.53678560257, -2.035861253738, 2.035861253738, 39.017890930176, 23.112604141235, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 23.112604141235, -2.035861253738, 39.017890930176, -2.035861253738, 19.637172698975, -5.511293888092, 35.542457580566, 19.637172698975, 19.637172698975, 19.637172698975, 35.542457580566, -5.511293888092, 17.253143310547, 17.253143310547, 34.232513427734, 17.253143310547, 1.53678560257, 45.362899780273, 1.53678560257, 1.53678560257, -2.035861253738, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 39.017890930176, 23.112604141235, -2.035861253738, -5.511293888092, 35.542457580566, 19.637172698975, 19.637172698975, 23.112604141235, 39.017890930176, -2.035861253738, -2.035861253738, 19.637172698975, 35.542457580566, -5.511293888092, 19.637172698975, 19.637172698975, 35.542457580566, 19.637172698975, -5.511293888092, 17.253143310547, 34.232513427734, 17.253143310547, 17.253143310547, 45.362899780273, 1.53678560257, 1.53678560257, 1.53678560257, 39.017890930176, -2.035861253738, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 35.542457580566, -5.511293888092, 19.637172698975, 19.637172698975, 39.017890930176, 23.112604141235, -2.035861253738, -2.035861253738, 35.542457580566, 19.637172698975, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 19.637172698975, -5.511293888092, 34.232513427734, 17.253143310547, 17.253143310547, 17.253143310547, -30.62745475769, -14.722168922424, -14.722168922424, 26.33158493042, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -40.115985870361, 3.71012878418, 3.71012878418, 20.689500808716, -20.689500808716, -3.71012878418, -3.71012878418, 40.115985870361, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -26.33158493042, 14.722168922424, 14.722168922424, 30.62745475769, -30.62745475769, -14.722168922424, 26.33158493042, -14.722168922424, -34.102886199951, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -40.115985870361, 3.71012878418, 20.689500808716, 3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -3.71012878418, -22.856151580811, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -26.33158493042, 14.722168922424, 30.62745475769, 14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -14.722168922424, -34.102886199951, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -40.115985870361, 20.689500808716, 3.71012878418, 3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -3.71012878418, -22.856151580811, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -26.33158493042, 30.62745475769, 14.722168922424, 14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -14.722168922424, 22.856151580811, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 20.689500808716, -40.115985870361, 3.71012878418, 3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -3.71012878418, 34.102886199951, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 30.62745475769, -26.33158493042, 14.722168922424, 14.722168922424, -34.232513427734, -17.253143310547, -17.253143310547, -17.253143310547, -35.542457580566, -19.637172698975, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, -19.637172698975, -39.017890930176, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -45.362899780273, -1.53678560257, -1.53678560257, -1.53678560257, -17.253143310547, -34.232513427734, -17.253143310547, -17.253143310547, -19.637172698975, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, -19.637172698975, -23.112604141235, -39.017890930176, 2.035861253738, 2.035861253738, 2.035861253738, -39.017890930176, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, -1.53678560257, -45.362899780273, -1.53678560257, -1.53678560257, -17.253143310547, -17.253143310547, -34.232513427734, -17.253143310547, -19.637172698975, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, -19.637172698975, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -39.017890930176, 2.035861253738, 2.035861253738, 2.035861253738, -39.017890930176, -23.112604141235, -1.53678560257, -1.53678560257, -45.362899780273, -1.53678560257, -17.253143310547, -17.253143310547, -17.253143310547, -34.232513427734, -19.637172698975, -19.637172698975, 5.511293888092, -35.542457580566, -19.637172698975, 5.511293888092, -19.637172698975, -35.542457580566, 5.511293888092, -19.637172698975, -19.637172698975, -35.542457580566, -23.112604141235, 2.035861253738, 2.035861253738, -39.017890930176, 2.035861253738, -23.112604141235, 2.035861253738, -39.017890930176, 2.035861253738, 2.035861253738, -23.112604141235, -39.017890930176, -1.53678560257, -1.53678560257, -1.53678560257, -45.362899780273, -14.722168922424, -30.62745475769, -14.722168922424, 26.33158493042, -18.197601318359, -34.102886199951, 6.950865268707, 22.856151580811, 6.950865268707, -34.102886199951, -18.197601318359, 22.856151580811, 3.71012878418, -40.115985870361, 3.71012878418, 20.689500808716, -3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -6.950865268707, -22.856151580811, 18.197601318359, 34.102886199951, 18.197601318359, -22.856151580811, -6.950865268707, 34.102886199951, 14.722168922424, -26.33158493042, 14.722168922424, 30.62745475769, -14.722168922424, -14.722168922424, -30.62745475769, 26.33158493042, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -34.102886199951, 22.856151580811, 3.71012878418, 3.71012878418, -40.115985870361, 20.689500808716, -3.71012878418, -3.71012878418, -20.689500808716, 40.115985870361, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -22.856151580811, 34.102886199951, 14.722168922424, 14.722168922424, -26.33158493042, 30.62745475769, -14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -18.197601318359, -34.102886199951, 22.856151580811, 6.950865268707, 6.950865268707, -34.102886199951, 22.856151580811, -18.197601318359, 3.71012878418, -40.115985870361, 20.689500808716, 3.71012878418, -3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -6.950865268707, -22.856151580811, 34.102886199951, 18.197601318359, 18.197601318359, -22.856151580811, 34.102886199951, -6.950865268707, 14.722168922424, -26.33158493042, 30.62745475769, 14.722168922424, -14.722168922424, -14.722168922424, 26.33158493042, -30.62745475769, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -34.102886199951, 3.71012878418, 3.71012878418, 20.689500808716, -40.115985870361, -3.71012878418, -3.71012878418, 40.115985870361, -20.689500808716, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -22.856151580811, 14.722168922424, 14.722168922424, 30.62745475769, -26.33158493042, -14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -18.197601318359, 22.856151580811, -34.102886199951, 6.950865268707, 6.950865268707, 22.856151580811, -34.102886199951, -18.197601318359, 3.71012878418, 20.689500808716, -40.115985870361, 3.71012878418, -3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -6.950865268707, 34.102886199951, -22.856151580811, 18.197601318359, 18.197601318359, 34.102886199951, -22.856151580811, -6.950865268707, 14.722168922424, 30.62745475769, -26.33158493042, 14.722168922424, -14.722168922424, 26.33158493042, -14.722168922424, -30.62745475769, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -34.102886199951, 3.71012878418, 20.689500808716, 3.71012878418, -40.115985870361, -3.71012878418, 40.115985870361, -3.71012878418, -20.689500808716, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -22.856151580811, 14.722168922424, 30.62745475769, 14.722168922424, -26.33158493042, 26.33158493042, -14.722168922424, -30.62745475769, -14.722168922424, 22.856151580811, -18.197601318359, -34.102886199951, 6.950865268707, 22.856151580811, 6.950865268707, -34.102886199951, -18.197601318359, 20.689500808716, 3.71012878418, -40.115985870361, 3.71012878418, 40.115985870361, -3.71012878418, -20.689500808716, -3.71012878418, 34.102886199951, -6.950865268707, -22.856151580811, 18.197601318359, 34.102886199951, 18.197601318359, -22.856151580811, -6.950865268707, 30.62745475769, 14.722168922424, -26.33158493042, 14.722168922424, 26.33158493042, -14.722168922424, -14.722168922424, -30.62745475769, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -34.102886199951, 20.689500808716, 3.71012878418, 3.71012878418, -40.115985870361, 40.115985870361, -3.71012878418, -3.71012878418, -20.689500808716, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -22.856151580811, 30.62745475769, 14.722168922424, 14.722168922424, -26.33158493042, 1.53678560257, 1.53678560257, 1.53678560257, 45.362899780273, -2.035861253738, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 39.017890930176, -5.511293888092, 19.637172698975, 19.637172698975, 35.542457580566, 23.112604141235, -2.035861253738, -2.035861253738, 39.017890930176, 19.637172698975, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 19.637172698975, -5.511293888092, 35.542457580566, 17.253143310547, 17.253143310547, 17.253143310547, 34.232513427734, 1.53678560257, 1.53678560257, 45.362899780273, 1.53678560257, -2.035861253738, 2.035861253738, 39.017890930176, 23.112604141235, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 23.112604141235, -2.035861253738, 39.017890930176, -2.035861253738, 19.637172698975, -5.511293888092, 35.542457580566, 19.637172698975, 19.637172698975, 19.637172698975, 35.542457580566, -5.511293888092, 17.253143310547, 17.253143310547, 34.232513427734, 17.253143310547, 1.53678560257, 45.362899780273, 1.53678560257, 1.53678560257, -2.035861253738, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 39.017890930176, 23.112604141235, -2.035861253738, -5.511293888092, 35.542457580566, 19.637172698975, 19.637172698975, 23.112604141235, 39.017890930176, -2.035861253738, -2.035861253738, 19.637172698975, 35.542457580566, -5.511293888092, 19.637172698975, 19.637172698975, 35.542457580566, 19.637172698975, -5.511293888092, 17.253143310547, 34.232513427734, 17.253143310547, 17.253143310547, 45.362899780273, 1.53678560257, 1.53678560257, 1.53678560257, 39.017890930176, -2.035861253738, -2.035861253738, 23.112604141235, 39.017890930176, -2.035861253738, 23.112604141235, -2.035861253738, 35.542457580566, -5.511293888092, 19.637172698975, 19.637172698975, 39.017890930176, 23.112604141235, -2.035861253738, -2.035861253738, 35.542457580566, 19.637172698975, -5.511293888092, 19.637172698975, 35.542457580566, 19.637172698975, 19.637172698975, -5.511293888092, 34.232513427734, 17.253143310547, 17.253143310547, 17.253143310547, -30.62745475769, -14.722168922424, -14.722168922424, 26.33158493042, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 22.856151580811, -40.115985870361, 3.71012878418, 3.71012878418, 20.689500808716, -20.689500808716, -3.71012878418, -3.71012878418, 40.115985870361, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 34.102886199951, -26.33158493042, 14.722168922424, 14.722168922424, 30.62745475769, -30.62745475769, -14.722168922424, 26.33158493042, -14.722168922424, -34.102886199951, -18.197601318359, 22.856151580811, 6.950865268707, -34.102886199951, 6.950865268707, 22.856151580811, -18.197601318359, -40.115985870361, 3.71012878418, 20.689500808716, 3.71012878418, -20.689500808716, -3.71012878418, 40.115985870361, -3.71012878418, -22.856151580811, -6.950865268707, 34.102886199951, 18.197601318359, -22.856151580811, 18.197601318359, 34.102886199951, -6.950865268707, -26.33158493042, 14.722168922424, 30.62745475769, 14.722168922424, -30.62745475769, 26.33158493042, -14.722168922424, -14.722168922424, -34.102886199951, 22.856151580811, -18.197601318359, 6.950865268707, -34.102886199951, 22.856151580811, 6.950865268707, -18.197601318359, -40.115985870361, 20.689500808716, 3.71012878418, 3.71012878418, -20.689500808716, 40.115985870361, -3.71012878418, -3.71012878418, -22.856151580811, 34.102886199951, -6.950865268707, 18.197601318359, -22.856151580811, 34.102886199951, 18.197601318359, -6.950865268707, -26.33158493042, 30.62745475769, 14.722168922424, 14.722168922424, 26.33158493042, -30.62745475769, -14.722168922424, -14.722168922424, 22.856151580811, -34.102886199951, -18.197601318359, 6.950865268707, 22.856151580811, -34.102886199951, 6.950865268707, -18.197601318359, 20.689500808716, -40.115985870361, 3.71012878418, 3.71012878418, 40.115985870361, -20.689500808716, -3.71012878418, -3.71012878418, 34.102886199951, -22.856151580811, -6.950865268707, 18.197601318359, 34.102886199951, -22.856151580811, 18.197601318359, -6.950865268707, 30.62745475769, -26.33158493042, 14.722168922424, 14.722168922424 };

constant static float const SKEW_4D = -0.138196601125011f;
constant static float const UNSKEW_4D = 0.309016994374947f;
constant static float const LATTICE_STEP_4D = 0.2f;
constant static float const RSQUARED_4D = 0.6f;
constant static long const SEED_OFFSET_4D = 0xE83DC3E0DA7164DL;

float grad(long seed, long xsvp, long ysvp, long zsvp, long wsvp, float dx, float dy, float dz, float dw) {
    long hash = seed ^ (xsvp ^ ysvp) ^ (zsvp ^ wsvp);
    hash *= HASH_MULTIPLIER;
    hash ^= hash >> (64 - N_GRADS_4D_EXPONENT + 2);
    int gi = (int)hash & ((N_GRADS_4D - 1) << 2);
    return (GRADIENTS_4D[gi | 0] * dx + GRADIENTS_4D[gi | 1] * dy) + (GRADIENTS_4D[gi | 2] * dz + GRADIENTS_4D[gi | 3] * dw);
}

float noise4_UnskewedBase(long seed, float xs, float ys, float zs, float ws) {

    // Get base points and offsets
    int xsb = fastFloor(xs), ysb = fastFloor(ys), zsb = fastFloor(zs), wsb = fastFloor(ws);
    float xsi = (float)(xs - xsb), ysi = (float)(ys - ysb), zsi = (float)(zs - zsb), wsi = (float)(ws - wsb);

    // Determine which lattice we can be confident has a contributing point its corresponding cell's base simplex.
    // We only look at the spaces between the diagonal planes. This proved effective in all of my tests.
    float siSum = (xsi + ysi) + (zsi + wsi);
    int startingLattice = (int)(siSum * 1.25);

    // Offset for seed based on first lattice copy.
    seed += startingLattice * SEED_OFFSET_4D;

    // Offset for lattice point relative positions (skewed)
    float startingLatticeOffset = startingLattice * -LATTICE_STEP_4D;
    xsi += startingLatticeOffset; ysi += startingLatticeOffset; zsi += startingLatticeOffset; wsi += startingLatticeOffset;

    // Prep for vertex contributions.
    float ssi = (siSum + startingLatticeOffset * 4) * UNSKEW_4D;

    // Prime pre-multiplication for hash.
    long xsvp = xsb * PRIME_X, ysvp = ysb * PRIME_Y, zsvp = zsb * PRIME_Z, wsvp = wsb * PRIME_W;

    // Five points to add, total, from five copies of the A4 lattice.
    float value = 0;
    for (int i = 0; ; i++) {

        // Next point is the closest vertex on the 4-simplex whose base vertex is the aforementioned vertex.
        float score0 = 1.0 + ssi * (-1.0 / UNSKEW_4D); // Seems slightly faster than 1.0-xsi-ysi-zsi-wsi
        if (xsi >= ysi && xsi >= zsi && xsi >= wsi && xsi >= score0) {
            xsvp += PRIME_X;
            xsi -= 1;
            ssi -= UNSKEW_4D;
        }
        else if (ysi > xsi && ysi >= zsi && ysi >= wsi && ysi >= score0) {
            ysvp += PRIME_Y;
            ysi -= 1;
            ssi -= UNSKEW_4D;
        }
        else if (zsi > xsi && zsi > ysi && zsi >= wsi && zsi >= score0) {
            zsvp += PRIME_Z;
            zsi -= 1;
            ssi -= UNSKEW_4D;
        }
        else if (wsi > xsi && wsi > ysi && wsi > zsi && wsi >= score0) {
            wsvp += PRIME_W;
            wsi -= 1;
            ssi -= UNSKEW_4D;
        }

        // gradient contribution with falloff.
        float dx = xsi + ssi, dy = ysi + ssi, dz = zsi + ssi, dw = wsi + ssi;
        float a = (dx * dx + dy * dy) + (dz * dz + dw * dw);
        if (a < RSQUARED_4D) {
            a -= RSQUARED_4D;
            a *= a;
            value += a * a * grad(seed, xsvp, ysvp, zsvp, wsvp, dx, dy, dz, dw);
        }

        // Break from loop if we're done, skipping updates below.
        if (i == 4) break;

        // Update for next lattice copy shifted down by <-0.2, -0.2, -0.2, -0.2>.
        xsi += LATTICE_STEP_4D; ysi += LATTICE_STEP_4D; zsi += LATTICE_STEP_4D; wsi += LATTICE_STEP_4D;
        ssi += LATTICE_STEP_4D * 4 * UNSKEW_4D;
        seed -= SEED_OFFSET_4D;

        // Because we don't always start on the same lattice copy, there's a special reset case.
        if (i == startingLattice) {
            xsvp -= PRIME_X;
            ysvp -= PRIME_Y;
            zsvp -= PRIME_Z;
            wsvp -= PRIME_W;
            seed += SEED_OFFSET_4D * 5;
        }
    }

    return value;
}

float noise4_ImproveXYZ_ImproveXY(long seed, float x, float y, float z, float w) {
    float xy = x + y;
    float s2 = xy * -0.21132486540518699998;
    float zz = z * 0.28867513459481294226;
    float ww = w * 0.2236067977499788;
    float xr = x + (zz + ww + s2), yr = y + (zz + ww + s2);
    float zr = xy * -0.57735026918962599998 + (zz + ww);
    float wr = z * -0.866025403784439 + ww;

    return noise4_UnskewedBase(seed, xr, yr, zr, wr);
}

float noise4_ImproveXYZ_ImproveXZ(long seed, float x, float y, float z, float w) {
    float xz = x + z;
    float s2 = xz * -0.21132486540518699998;
    float yy = y * 0.28867513459481294226;
    float ww = w * 0.2236067977499788;
    float xr = x + (yy + ww + s2), zr = z + (yy + ww + s2);
    float yr = xz * -0.57735026918962599998 + (yy + ww);
    float wr = y * -0.866025403784439 + ww;

    return noise4_UnskewedBase(seed, xr, yr, zr, wr);
}

float noise4_ImproveXYZ(long seed, float x, float y, float z, float w) {

    float xyz = x + y + z;
    float ww = w * 0.2236067977499788;
    float s2 = xyz * -0.16666666666666666 + ww;
    float xs = x + s2, ys = y + s2, zs = z + s2, ws = -0.5 * xyz + ww;

    return noise4_UnskewedBase(seed, xs, ys, zs, ws);
}

float noise4_ImproveXY_ImproveZW(long seed, float x, float y, float z, float w) {

    float s2 = (x + y) * -0.178275657951399372 + (z + w) * 0.215623393288842828;
    float t2 = (z + w) * -0.403949762580207112 + (x + y) * -0.375199083010075342;
    float xs = x + s2, ys = y + s2, zs = z + t2, ws = w + t2;

    return noise4_UnskewedBase(seed, xs, ys, zs, ws);
}

/**
 * 4D OpenSimplex2 noise, fallback lattice orientation.
 */
float noise4_Fallback(long seed, float x, float y, float z, float w) {

    // Get points for A4 lattice
    float s = SKEW_4D * (x + y + z + w);
    float xs = x + s, ys = y + s, zs = z + s, ws = w + s;

    return noise4_UnskewedBase(seed, xs, ys, zs, ws);
}

kernel void openSimplexNoise4(
    constant OpenSimplex2MetalParameters &uniforms [[ buffer(0) ]],
    constant const float4 * in                     [[ buffer(1) ]],
    device float * out                             [[ buffer(2) ]],
    uint2 thread_position_in_grid                  [[ thread_position_in_grid ]]
) {
    int index = thread_position_in_grid.x;

    switch (uniforms.noise4Variant) {
        case OpenSimplex2MetalNoise4Variant::xyz:
            out[index] = noise4_ImproveXYZ(uniforms.seed, in[index].x, in[index].y, in[index].z, in[index].w);
            break;
        case OpenSimplex2MetalNoise4Variant::xyz_xy:
            out[index] = noise4_ImproveXYZ_ImproveXY(uniforms.seed, in[index].x, in[index].y, in[index].z, in[index].w);
            break;
        case OpenSimplex2MetalNoise4Variant::xyz_xz:
            out[index] = noise4_ImproveXYZ_ImproveXZ(uniforms.seed, in[index].x, in[index].y, in[index].z, in[index].w);
            break;
        case OpenSimplex2MetalNoise4Variant::xy_zw:
            out[index] = noise4_ImproveXY_ImproveZW(uniforms.seed, in[index].x, in[index].y, in[index].z, in[index].w);
            break;
        case OpenSimplex2MetalNoise4Variant::fallback:
            out[index] = noise4_Fallback(uniforms.seed, in[index].x, in[index].y, in[index].z, in[index].w);
            break;
    }
}

